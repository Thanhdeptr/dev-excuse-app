# Bước 1: Bắt đầu từ image Node.js 18 trên nền Alpine
# Image này đã có sẵn user 'node' (UID 1000) và group 'node' (GID 1000)
FROM node:18-alpine

# Bước 2: Chuyển sang user 'root' tạm thời để cài đặt các gói
USER root

# Bước 3: Cài đặt tất cả các công cụ (dependencies) còn thiếu
RUN apk add --no-cache \
    git \
    docker-cli \
    openssh-client

# Bước 4: Chuyển về user 'node' (không-phải-root) để chạy pipeline
# User này đã có UID/GID là 1000, khớp với Jenkins Master
USER node

# Bước 5: Đặt thư mục làm việc mặc định cho agent
WORKDIR /home/node